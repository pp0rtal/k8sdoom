(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();class U{lastTime=0;accumulator=0;running=!1;fixedDt;updateFn;renderFn;constructor(t,e,i){this.fixedDt=t,this.updateFn=e,this.renderFn=i}start(){this.running=!0,this.lastTime=performance.now(),requestAnimationFrame(t=>this.tick(t))}tick(t){if(!this.running)return;const e=Math.min((t-this.lastTime)/1e3,.1);for(this.lastTime=t,this.accumulator+=e;this.accumulator>=this.fixedDt;)this.updateFn(this.fixedDt),this.accumulator-=this.fixedDt;this.renderFn(this.accumulator/this.fixedDt),requestAnimationFrame(i=>this.tick(i))}stop(){this.running=!1}}const h=960,f=600,J=Math.PI/3,W=h,T=64,M=64,k=3,_=2,z=.25,j=100,N=-.5,Z=10,x=1,q=8,Q=0,tt=1e6,et=100,st=25,B=10,it=500,I=1e4,at=I,ot=60,nt=1/ot;class rt{pos;dir;plane;constructor(t,e,i){this.pos={x:t,y:e},this.dir={x:Math.cos(i),y:Math.sin(i)};const s=Math.tan(J/2);this.plane={x:-this.dir.y*s,y:this.dir.x*s}}rotate(t){const e=Math.cos(t),i=Math.sin(t),s=this.dir.x;this.dir.x=this.dir.x*e-this.dir.y*i,this.dir.y=s*i+this.dir.y*e;const a=this.plane.x;this.plane.x=this.plane.x*e-this.plane.y*i,this.plane.y=a*i+this.plane.y*e}}class lt{castAllRays(t,e){const i=new Array(W);for(let s=0;s<W;s++)i[s]=this.castRay(t,e,s);return i}castRay(t,e,i){const s=2*i/W-1,a=t.dir.x+t.plane.x*s,o=t.dir.y+t.plane.y*s;let n=Math.floor(t.pos.x),r=Math.floor(t.pos.y);const l=Math.abs(1/a),c=Math.abs(1/o);let d,u,m,y;a<0?(d=-1,m=(t.pos.x-n)*l):(d=1,m=(n+1-t.pos.x)*l),o<0?(u=-1,y=(t.pos.y-r)*c):(u=1,y=(r+1-t.pos.y)*c);let E=0,K=64;for(;K-- >0&&(m<y?(m+=l,n+=d,E=0):(y+=c,r+=u,E=1),!(r>=0&&r<e.height&&n>=0&&n<e.width&&e.grid[r][n]>0)););const O=E===0?m-l:y-c;let L=E===0?t.pos.y+O*o:t.pos.x+O*a;return L-=Math.floor(L),{distance:Math.max(O,.001),wallX:L,side:E,mapX:n,mapY:r,tileType:r>=0&&r<e.height&&n>=0&&n<e.width?e.grid[r][n]:1}}}class ht{textures=new Map;constructor(){this.generateWallTextures()}generateWallTextures(){this.textures.set(1,this.generateBlueBrick()),this.textures.set(2,this.generateMetalPanel()),this.textures.set(3,this.generateCircuitBoard()),this.textures.set(4,this.generateWarningStripes())}generateBlueBrick(){const t=new Uint8ClampedArray(T*M*4),e=16,i=32;for(let s=0;s<M;s++)for(let a=0;a<T;a++){const n=Math.floor(s/e)%2*(i/2),r=(a+n)%i,l=s%e===0||r===0,c=(s*T+a)*4;if(l)t[c]=30,t[c+1]=40,t[c+2]=60,t[c+3]=255;else{const d=Math.random()*15-7;t[c]=50+d,t[c+1]=108+d,t[c+2]=229+Math.min(0,d),t[c+3]=255}}return t}generateMetalPanel(){const t=new Uint8ClampedArray(T*M*4);for(let e=0;e<M;e++)for(let i=0;i<T;i++){const s=(e*T+i)*4,a=e%32===0||i%32===0;if((e%32===4||e%32===28)&&i%8===4)t[s]=160,t[s+1]=160,t[s+2]=170,t[s+3]=255;else if(a)t[s]=40,t[s+1]=40,t[s+2]=45,t[s+3]=255;else{const n=Math.random()*10-5;t[s]=80+n,t[s+1]=82+n,t[s+2]=88+n,t[s+3]=255}}return t}generateCircuitBoard(){const t=new Uint8ClampedArray(T*M*4);for(let e=0;e<M;e++)for(let i=0;i<T;i++){const s=(e*T+i)*4;if(i%8===0||e%8===0)t[s]=30,t[s+1]=180,t[s+2]=30,t[s+3]=255;else{const o=Math.random()*8-4;t[s]=15+o,t[s+1]=50+o,t[s+2]=15+o,t[s+3]=255}}return t}generateWarningStripes(){const t=new Uint8ClampedArray(T*M*4);for(let e=0;e<M;e++)for(let i=0;i<T;i++){const s=(e*T+i)*4;(i+e)%16<8?(t[s]=220,t[s+1]=200,t[s+2]=0,t[s+3]=255):(t[s]=30,t[s+1]=30,t[s+2]=30,t[s+3]=255)}return t}getPixel(t,e,i){const s=this.textures.get(t);if(!s)return[128,128,128];const a=(i*T+e)*4;return[s[a],s[a+1],s[a+2]]}}class ft{imageData;buf;zBuffer;ctx;textures;constructor(t,e){this.ctx=t,this.textures=e,this.imageData=t.createImageData(h,f),this.buf=new Uint32Array(this.imageData.data.buffer),this.zBuffer=new Array(h)}renderFrame(t){this.drawCeilingAndFloor(),this.drawWalls(t),this.ctx.putImageData(this.imageData,0,0)}drawCeilingAndFloor(){const t=f/2;for(let e=0;e<f;e++){const i=e<t?t/(t-e):t/(e-t+1),s=Math.min(1,i/14),a=e*h;if(e<t){const n=Math.floor(25*(1-s*.7)),r=Math.floor(25*(1-s*.7)),l=Math.floor(40*(1-s*.5)),c=255<<24|l<<16|r<<8|n;for(let d=0;d<h;d++)this.buf[a+d]=c}else{const n=Math.floor(20*(1-s*.8)),r=Math.floor(25*(1-s*.8)),l=Math.floor(20*(1-s*.8)),c=255<<24|l<<16|r<<8|n;for(let d=0;d<h;d++)this.buf[a+d]=c}}}drawWalls(t){for(let e=0;e<t.length;e++){const i=t[e];this.zBuffer[e]=i.distance;const s=Math.floor(f/i.distance),a=Math.max(0,Math.floor(-s/2+f/2)),o=Math.min(f-1,Math.floor(s/2+f/2));let n=Math.floor(i.wallX*T);n>=T&&(n=T-1);const r=M/s;let l=(a-f/2+s/2)*r;for(let c=a;c<=o;c++){const d=Math.floor(l)&M-1;l+=r;let[u,m,y]=this.textures.getPixel(i.tileType,n,d);i.side===1&&(u=u>>1,m=m>>1,y=y>>1);const E=Math.min(1,i.distance/12);u=Math.floor(u*(1-E)),m=Math.floor(m*(1-E)),y=Math.floor(y*(1-E)),this.buf[c*h+e]=255<<24|y<<16|m<<8|u}}}}const H=["sendBufferEmailsEachOneMinute * * * * *","sendBufferEmailsEachOneMinute * * * * *","sendBufferEmailsEachOneMinute * * * * *","sendBufferEmailsEachOneMinute * * * * *","sendBufferEmailsEachOneMinute * * * * *","sendBufferEmailsEachOneMinute * * * * *","sendBufferEmailsEachOneMinute * * * * *","sendBufferEmailsEachFiveMinutes */5 * * * *","sendBufferEmailsEachFiveMinutes */5 * * * *","programFinished * * * * *","triggerUsersProgressWhenClassroomSlotEnds * * * * *","sendClassroomSlotNotifications * * * * *"];class G{pos;dir;health;alive;cronExpression;state;patrolTarget;attackCooldown;deathTimer;constructor(t){this.pos={x:t.x,y:t.y},this.dir={x:1,y:0},this.health=Z,this.alive=!0,this.cronExpression=H[Math.floor(Math.random()*H.length)],this.state="patrol",this.patrolTarget=null,this.attackCooldown=0,this.deathTimer=0}takeDamage(t){return this.health-=t,this.health<=0?(this.alive=!1,this.state="dead",this.deathTimer=2,!0):!1}}class ct{spriteBuffer;spriteCtx;constructor(){this.spriteBuffer=new OffscreenCanvas(64,64),this.spriteCtx=this.spriteBuffer.getContext("2d")}renderSprites(t,e,i,s){const a=[];for(const o of i){if(!o.alive&&o.deathTimer<=0)continue;const n=this.computeSpriteData(e,o);n&&a.push(n)}a.sort((o,n)=>n.transformY-o.transformY);for(const o of a)this.drawSprite(t,o,s)}computeSpriteData(t,e){const i=e.pos.x-t.pos.x,s=e.pos.y-t.pos.y,a=1/(t.plane.x*t.dir.y-t.dir.x*t.plane.y),o=a*(t.dir.y*i-t.dir.x*s),n=a*(-t.plane.y*i+t.plane.x*s);if(n<=.1)return null;const r=Math.floor(h/2*(1+o/n)),l=Math.abs(Math.floor(f/n)),c=l,d=Math.max(0,Math.floor(-l/2+f/2)),u=Math.min(f-1,Math.floor(l/2+f/2)),m=Math.max(0,Math.floor(-c/2+r)),y=Math.min(h-1,Math.floor(c/2+r));return{screenX:r,transformY:n,spriteHeight:l,spriteWidth:c,drawStartX:m,drawEndX:y,drawStartY:d,drawEndY:u,entity:e}}drawSprite(t,e,i){this.renderCronJobTexture(e.entity);const s=e.screenX-e.spriteWidth/2,a=e.drawEndY-e.drawStartY;for(let o=e.drawStartX;o<=e.drawEndX;o++)if(e.transformY<i[o]){const n=Math.floor((o-s)/e.spriteWidth*64);n>=0&&n<64&&t.drawImage(this.spriteBuffer,n,0,1,64,o,e.drawStartY,1,a)}}renderCronJobTexture(t){const e=this.spriteCtx;e.clearRect(0,0,64,64);const i=t.alive?t.health>15?"#326CE5":"#CC0000":"#555";e.fillStyle=i,this.roundRect(e,4,4,56,56,8),e.fill(),e.strokeStyle="#fff",e.lineWidth=1.5,e.beginPath(),e.arc(32,20,9,0,Math.PI*2),e.stroke();for(let s=0;s<7;s++){const a=s/7*Math.PI*2;e.beginPath(),e.moveTo(32+Math.cos(a)*4,20+Math.sin(a)*4),e.lineTo(32+Math.cos(a)*9,20+Math.sin(a)*9),e.stroke()}e.fillStyle="#fff",e.font="bold 9px monospace",e.textAlign="center",e.fillText("CronJob",32,44),e.font="7px monospace",e.fillStyle="#aaddff",e.fillText(t.cronExpression,32,56)}roundRect(t,e,i,s,a,o){t.beginPath(),t.moveTo(e+o,i),t.lineTo(e+s-o,i),t.quadraticCurveTo(e+s,i,e+s,i+o),t.lineTo(e+s,i+a-o),t.quadraticCurveTo(e+s,i+a,e+s-o,i+a),t.lineTo(e+o,i+a),t.quadraticCurveTo(e,i+a,e,i+a-o),t.lineTo(e,i+o),t.quadraticCurveTo(e,i,e+o,i),t.closePath()}}class dt{keys=new Set;_mouseDeltaX=0;pointerLocked=!1;shootTriggered=!1;canvas;constructor(t){this.canvas=t,document.addEventListener("keydown",e=>{this.keys.add(e.code),e.preventDefault()}),document.addEventListener("keyup",e=>{this.keys.delete(e.code)}),document.addEventListener("mousemove",e=>{this.pointerLocked&&(this._mouseDeltaX+=e.movementX)}),document.addEventListener("mousedown",e=>{e.button===0&&this.pointerLocked&&(this.shootTriggered=!0)}),t.addEventListener("click",()=>{this.pointerLocked||t.requestPointerLock()}),document.addEventListener("pointerlockchange",()=>{this.pointerLocked=document.pointerLockElement===this.canvas})}get isPointerLocked(){return this.pointerLocked}getState(){const t=this.shootTriggered||this.keys.has("Space");this.shootTriggered=!1;const e={forward:this.keys.has("KeyW")||this.keys.has("ArrowUp"),backward:this.keys.has("KeyS")||this.keys.has("ArrowDown"),strafeLeft:this.keys.has("KeyA"),strafeRight:this.keys.has("KeyD"),rotateLeft:this.keys.has("ArrowLeft"),rotateRight:this.keys.has("ArrowRight"),shoot:t,mouseDeltaX:this._mouseDeltaX};return this._mouseDeltaX=0,e}}class v{static SCALE=6;static OPACITY=.7;render(t,e,i,s){const a=v.SCALE,o=10,n=10;t.save(),t.globalAlpha=v.OPACITY;for(let r=0;r<e.height;r++)for(let l=0;l<e.width;l++)t.fillStyle=e.grid[r][l]>0?"#555":"#111",t.fillRect(o+l*a,n+r*a,a,a);t.fillStyle="#326CE5",t.beginPath(),t.arc(o+i.pos.x*a,n+i.pos.y*a,3,0,Math.PI*2),t.fill(),t.strokeStyle="#326CE5",t.lineWidth=2,t.beginPath(),t.moveTo(o+i.pos.x*a,n+i.pos.y*a),t.lineTo(o+(i.pos.x+i.dir.x*2)*a,n+(i.pos.y+i.dir.y*2)*a),t.stroke();for(const r of s)r.alive&&(t.fillStyle="#f00",t.beginPath(),t.arc(o+r.pos.x*a,n+r.pos.y*a,2,0,Math.PI*2),t.fill());t.restore()}}class pt{static generate(t,e){const i=[];for(let o=0;o<e;o++){i[o]=[];for(let n=0;n<t;n++)i[o][n]=1}const s=[];for(let o=0;o<e;o++)s[o]=new Array(t).fill(!1);const a=(o,n)=>{s[n][o]=!0,i[n][o]=0;const r=[[0,-2],[0,2],[-2,0],[2,0]];for(let l=r.length-1;l>0;l--){const c=Math.floor(Math.random()*(l+1));[r[l],r[c]]=[r[c],r[l]]}for(const[l,c]of r){const d=o+l,u=n+c;d>0&&d<t-1&&u>0&&u<e-1&&!s[u][d]&&(i[n+c/2][o+l/2]=0,a(d,u))}};a(1,1);for(let o=0;o<e;o++)for(let n=0;n<t;n++)i[o][n]>0&&(i[o][n]=(n*7+o*13)%4+1);return i}}const C=10;class ut{map;entities;spawnPoints;constructor(){const t=pt.generate(C,C);this.map={width:C,height:C,grid:t},this.spawnPoints=this.findOpenCells(30),this.entities=[]}isWall(t,e){const i=Math.floor(t),s=Math.floor(e);return isNaN(i)||isNaN(s)||i<0||i>=this.map.width||s<0||s>=this.map.height?!0:this.map.grid[s][i]>0}findOpenCells(t){const e=[];for(let i=1;i<this.map.height-1;i++)for(let s=1;s<this.map.width-1;s++)this.map.grid[i][s]===0&&e.push({x:s+.5,y:i+.5});for(let i=e.length-1;i>0;i--){const s=Math.floor(Math.random()*(i+1));[e[i],e[s]]=[e[s],e[i]]}return e.slice(0,t)}findPlayerStart(){for(let t=1;t<this.map.height-1;t++)for(let e=1;e<this.map.width-1;e++)if(this.map.grid[t][e]===0){const i={x:e+.5,y:t+.5};if(this.spawnPoints.reduce((a,o)=>{const n=Math.sqrt((o.x-i.x)**2+(o.y-i.y)**2);return Math.min(a,n)},1/0)>4)return i}return this.findOpenCells(1)[0]}}class mt{camera;health;ammo;score;kills;constructor(t){this.camera=new rt(t.x,t.y,0),this.health=j,this.ammo=at,this.score=0,this.kills=0}update(t,e,i){e.rotateLeft&&this.camera.rotate(-_*t),e.rotateRight&&this.camera.rotate(_*t),e.mouseDeltaX!==0&&this.camera.rotate(e.mouseDeltaX*.003);let s=0,a=0;e.forward&&(s+=this.camera.dir.x*k*t,a+=this.camera.dir.y*k*t),e.backward&&(s-=this.camera.dir.x*k*t,a-=this.camera.dir.y*k*t),e.strafeLeft&&(s-=this.camera.plane.x*k*t,a-=this.camera.plane.y*k*t),e.strafeRight&&(s+=this.camera.plane.x*k*t,a+=this.camera.plane.y*k*t),this.applyMovement(s,a,i)}get isMoving(){return!1}applyMovement(t,e,i){if(t===0&&e===0)return;const s=z,a=this.camera.pos.x+t;!i.isWall(a+s,this.camera.pos.y+s)&&!i.isWall(a+s,this.camera.pos.y-s)&&!i.isWall(a-s,this.camera.pos.y+s)&&!i.isWall(a-s,this.camera.pos.y-s)&&(this.camera.pos.x=a);const o=this.camera.pos.y+e;!i.isWall(this.camera.pos.x+s,o+s)&&!i.isWall(this.camera.pos.x+s,o-s)&&!i.isWall(this.camera.pos.x-s,o+s)&&!i.isWall(this.camera.pos.x-s,o-s)&&(this.camera.pos.y=o)}}class Tt{update(t,e,i,s){if(!t.alive){t.deathTimer-=s;return}const a=this.distance(t.pos,e.camera.pos),o=this.lineOfSight(t.pos,e.camera.pos,i);switch(t.state){case"patrol":this.patrol(t,i,s),o&&a<q&&(t.state="chase");break;case"chase":this.chase(t,e,i,s),a<x?t.state="attack":(!o||a>q*1.5)&&(t.state="patrol");break;case"attack":this.attack(t,e,s),a>x*1.5&&(t.state="chase");break}}patrol(t,e,i){(!t.patrolTarget||this.distance(t.pos,t.patrolTarget)<.5)&&(t.patrolTarget=this.randomOpenNeighbor(t.pos,e)),t.patrolTarget&&this.moveToward(t,t.patrolTarget,N*.5,e,i)}chase(t,e,i,s){this.moveToward(t,e.camera.pos,N,i,s)}attack(t,e,i){t.attackCooldown-=i,t.attackCooldown<=0&&(e.health-=Q,t.attackCooldown=1.5)}lineOfSight(t,e,i){const s=e.x-t.x,a=e.y-t.y,o=Math.sqrt(s*s+a*a),n=Math.ceil(o*4);for(let r=0;r<=n;r++){const l=r/n,c=t.x+s*l,d=t.y+a*l;if(i.isWall(c,d))return!1}return!0}moveToward(t,e,i,s,a){const o=e.x-t.pos.x,n=e.y-t.pos.y,r=Math.sqrt(o*o+n*n);if(r<.01)return;const l=o/r*i*a,c=n/r*i*a,d=.2,u=t.pos.x+l,m=t.pos.y+c;!s.isWall(u+d*Math.sign(l),t.pos.y+d)&&!s.isWall(u+d*Math.sign(l),t.pos.y-d)&&(t.pos.x=u),!s.isWall(t.pos.x+d,m+d*Math.sign(c))&&!s.isWall(t.pos.x-d,m+d*Math.sign(c))&&(t.pos.y=m),t.dir={x:o/r,y:n/r}}distance(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}randomOpenNeighbor(t,e){for(let i=0;i<10;i++){const s=Math.floor(t.x)+Math.floor(Math.random()*7)-3,a=Math.floor(t.y)+Math.floor(Math.random()*7)-3;if(!e.isWall(s+.5,a+.5))return{x:s+.5,y:a+.5}}return null}}class gt{respawnTimers=[];enemyAI=new Tt;world;constructor(t){this.world=t;for(const e of t.spawnPoints){const i=new G(e);t.entities.push(i)}}update(t,e){for(const i of this.world.entities)this.enemyAI.update(i,e,this.world,t);for(let i=this.world.entities.length-1;i>=0;i--){const s=this.world.entities[i];if(!s.alive&&s.deathTimer<=0){this.world.entities.splice(i,1);const a=Math.floor(Math.random()*this.world.spawnPoints.length);this.respawnTimers.push({spawnPointIdx:a,timer:tt/1e3})}}for(let i=this.respawnTimers.length-1;i>=0;i--)if(this.respawnTimers[i].timer-=t,this.respawnTimers[i].timer<=0){if(this.world.entities.length<et){const s=this.world.spawnPoints[this.respawnTimers[i].spawnPointIdx];this.world.entities.push(new G(s))}this.respawnTimers.splice(i,1)}}}class yt{state="idle";animTimer=0;bobPhase=0;recoilOffset=0;update(t,e){switch(e&&(this.bobPhase+=t*8),this.state){case"firing":this.animTimer-=t,this.recoilOffset=Math.max(0,this.animTimer/.1)*20,this.animTimer<=0&&(this.state="cooldown",this.animTimer=it/1e3);break;case"cooldown":this.animTimer-=t,this.recoilOffset=0,this.animTimer<=0&&(this.state="idle");break}}fire(){return this.state!=="idle"?!1:(this.state="firing",this.animTimer=.1,!0)}render(t){const e=Math.sin(this.bobPhase)*4,i=Math.abs(Math.cos(this.bobPhase))*4,s=h/2-40+e,a=f-120+i+this.recoilOffset;t.save(),t.fillStyle="#222",t.beginPath(),this.roundedRect(t,s,a,80,100,6),t.fill(),t.strokeStyle="#444",t.lineWidth=1,t.beginPath(),this.roundedRect(t,s,a,80,100,6),t.stroke(),t.fillStyle="#0a0a0a",t.fillRect(s+8,a+8,64,44),t.fillStyle="#00ff00",t.font="8px monospace",t.textAlign="left",t.fillText("$ kubectl",s+12,a+22),t.fillText("  delete pod",s+12,a+34),t.fillStyle="#00aa00",t.fillText("  --force",s+12,a+46),t.fillStyle="#444",t.fillRect(s+30,a-10,20,15),t.fillStyle="#333",t.fillRect(s+33,a-8,14,11),this.state==="firing"&&(t.fillStyle="#ffaa00",t.globalAlpha=.8,t.beginPath(),t.arc(s+40,a-15,25,0,Math.PI*2),t.fill(),t.fillStyle="#fff",t.beginPath(),t.arc(s+40,a-15,12,0,Math.PI*2),t.fill(),t.globalAlpha=1),t.restore()}roundedRect(t,e,i,s,a,o){t.moveTo(e+o,i),t.lineTo(e+s-o,i),t.quadraticCurveTo(e+s,i,e+s,i+o),t.lineTo(e+s,i+a-o),t.quadraticCurveTo(e+s,i+a,e+s-o,i+a),t.lineTo(e+o,i+a),t.quadraticCurveTo(e,i+a,e,i+a-o),t.lineTo(e,i+o),t.quadraticCurveTo(e,i,e+o,i),t.closePath()}}class Mt{hitFeedbackTimer=0;killFeedbackTimer=0;lastKillLabel="";damageFlashTimer=0;tryShoot(t,e,i){if(t.ammo<=0||!e.fire())return{hit:!1,enemy:null,killed:!1};t.ammo--;const s=t.camera;let a=null,o=B;for(const n of i.entities){if(!n.alive)continue;const r=n.pos.x-s.pos.x,l=n.pos.y-s.pos.y,c=r*s.dir.x+l*s.dir.y;if(c<=0||c>B)continue;Math.abs(r*s.dir.y-l*s.dir.x)<.4&&c<o&&this.hasLineOfSight(s.pos,n.pos,i)&&(o=c,a=n)}if(a){const n=a.takeDamage(st);return this.hitFeedbackTimer=.15,n&&(t.score+=100,t.kills++,this.killFeedbackTimer=1.5,this.lastKillLabel=`kubectl delete pod ${a.cronExpression}`),{hit:!0,enemy:a,killed:n}}return{hit:!1,enemy:null,killed:!1}}onPlayerDamaged(){this.damageFlashTimer=.3}update(t){this.hitFeedbackTimer>0&&(this.hitFeedbackTimer-=t),this.killFeedbackTimer>0&&(this.killFeedbackTimer-=t),this.damageFlashTimer>0&&(this.damageFlashTimer-=t)}renderFeedback(t){const e=h/2,i=f/2;if(t.strokeStyle=this.hitFeedbackTimer>0?"#ff0000":"#00ff00",t.lineWidth=2,t.beginPath(),t.moveTo(e-12,i),t.lineTo(e-4,i),t.moveTo(e+4,i),t.lineTo(e+12,i),t.moveTo(e,i-12),t.lineTo(e,i-4),t.moveTo(e,i+4),t.lineTo(e,i+12),t.stroke(),t.fillStyle=this.hitFeedbackTimer>0?"#ff0000":"#00ff00",t.beginPath(),t.arc(e,i,2,0,Math.PI*2),t.fill(),this.hitFeedbackTimer>0&&(t.fillStyle=`rgba(255, 50, 0, ${this.hitFeedbackTimer/.15*.15})`,t.beginPath(),t.arc(e,i,18,0,Math.PI*2),t.fill()),this.killFeedbackTimer>0){const s=Math.min(1,this.killFeedbackTimer);t.fillStyle=`rgba(255, 255, 255, ${s})`,t.font="bold 14px monospace",t.textAlign="center",t.fillText(this.lastKillLabel,h/2,f/2+50)}if(this.damageFlashTimer>0){const s=this.damageFlashTimer/.3*.4;t.fillStyle=`rgba(255, 0, 0, ${s})`,t.fillRect(0,0,h,f)}}hasLineOfSight(t,e,i){const s=e.x-t.x,a=e.y-t.y,o=Math.sqrt(s*s+a*a),n=Math.ceil(o*4);for(let r=1;r<n;r++){const l=r/n;if(i.isWall(t.x+s*l,t.y+a*l))return!1}return!0}}class bt{phase="menu";elapsedTime=0;transitionTo(t){this.phase=t,t==="playing"&&(this.elapsedTime=0)}update(t){this.phase==="playing"&&(this.elapsedTime+=t)}}class St{render(t,e,i){t.save(),t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(0,f-50,h,50),t.font="bold 14px monospace";const s=e.health>60?"#00ff00":e.health>30?"#ffaa00":"#ff0000";t.fillStyle=s,t.textAlign="left",t.fillText(`HEALTH: ${Math.max(0,e.health)}`,20,f-18),t.strokeStyle="#555",t.lineWidth=1,t.strokeRect(20,f-45,100,10),t.fillStyle=s,t.fillRect(20,f-45,Math.max(0,e.health),10),t.fillStyle=e.ammo>10?"#00ff00":"#ff0000",t.textAlign="center",t.fillText(`AMMO: ${e.ammo}/${I}`,h/2,f-18);const a=100,o=h/2-a/2;t.strokeStyle="#555",t.strokeRect(o,f-45,a,10),t.fillStyle=e.ammo>10?"#00ff00":"#ff0000",t.fillRect(o,f-45,e.ammo/I*a,10),t.fillStyle="#326CE5",t.textAlign="right",t.fillText(`SCORE: ${e.score}`,h-20,f-28),t.fillStyle="#aaa",t.font="12px monospace",t.fillText(`PODS DELETED: ${e.kills}`,h-20,f-12),t.fillStyle="#888",t.font="12px monospace",t.textAlign="right";const n=Math.floor(i.elapsedTime/60),r=Math.floor(i.elapsedTime%60);t.fillText(`TIME: ${String(n).padStart(2,"0")}:${String(r).padStart(2,"0")}`,h-20,20),t.restore()}}class Et{wheelAngle=0;update(t){this.wheelAngle+=t*.5}renderTitle(t){t.fillStyle="#000",t.fillRect(0,0,h,f),t.fillStyle="rgba(50, 108, 229, 0.03)";for(let i=0;i<f;i+=4)t.fillRect(0,i,h,2);t.fillStyle="#326CE5",t.font="bold 52px monospace",t.textAlign="center",t.fillText("K8S DOOM",h/2,f/4),t.fillStyle="#aaa",t.font="16px monospace",t.fillText("Terminate the CronJobs pods to make space for production web workers",h/2,f/4+35),this.drawK8sWheel(t,h/2,f/2,45),t.fillStyle="#666",t.font="13px monospace",t.fillText("WASD - Move  |  Mouse - Look  |  Click/Space - Shoot",h/2,f*.72),t.fillText("ESC - Release mouse  |  M - Toggle minimap",h/2,f*.76),t.fillStyle="#326CE5",t.font="bold 18px monospace",Math.sin(Date.now()/500)>0&&t.fillText("[ CLICK TO START ]",h/2,f*.87)}renderGameOver(t,e,i){t.fillStyle="rgba(0, 0, 0, 0.85)",t.fillRect(0,0,h,f),t.fillStyle="#ff0000",t.font="bold 44px monospace",t.textAlign="center",t.fillText("CLUSTER",h/2,f/4),t.fillText("TERMINATED",h/2,f/4+50),t.fillStyle="#888",t.font="16px monospace",t.fillText("CronJobs overwhelmed the cluster",h/2,f/4+90),t.fillStyle="#aaa",t.font="18px monospace";const s=f/2+10;t.fillText(`Pods Deleted: ${e.kills}`,h/2,s),t.fillText(`Score: ${e.score}`,h/2,s+30);const a=Math.floor(i/60),o=Math.floor(i%60);t.fillText(`Time Survived: ${String(a).padStart(2,"0")}:${String(o).padStart(2,"0")}`,h/2,s+60),t.fillStyle="#326CE5",t.font="bold 16px monospace",Math.sin(Date.now()/500)>0&&t.fillText("[ CLICK TO RESTART ]",h/2,f*.85)}drawK8sWheel(t,e,i,s){t.save(),t.translate(e,i),t.rotate(this.wheelAngle),t.strokeStyle="#326CE5",t.lineWidth=3,t.beginPath(),t.arc(0,0,s,0,Math.PI*2),t.stroke(),t.beginPath(),t.arc(0,0,s*.3,0,Math.PI*2),t.stroke();for(let a=0;a<7;a++){const o=a/7*Math.PI*2,n=s*.3,r=s*.85;t.beginPath(),t.moveTo(Math.cos(o)*n,Math.sin(o)*n),t.lineTo(Math.cos(o)*r,Math.sin(o)*r),t.stroke(),t.fillStyle="#326CE5",t.beginPath(),t.arc(Math.cos(o)*r,Math.sin(o)*r,6,0,Math.PI*2),t.fill()}t.restore()}}class wt{enabled=!0;scanlinePattern=null;constructor(t){const e=new OffscreenCanvas(h,4),i=e.getContext("2d");i.clearRect(0,0,h,4),i.fillStyle="rgba(0, 0, 0, 0.12)",i.fillRect(0,2,h,2),this.scanlinePattern=t.createPattern(e,"repeat")}toggle(){this.enabled=!this.enabled}apply(t){if(!this.enabled)return;t.save(),this.scanlinePattern&&(t.fillStyle=this.scanlinePattern,t.fillRect(0,0,h,f));const e=t.createRadialGradient(h/2,f/2,h*.3,h/2,f/2,h*.7);e.addColorStop(0,"rgba(0, 0, 0, 0)"),e.addColorStop(1,"rgba(0, 0, 0, 0.45)"),t.fillStyle=e,t.fillRect(0,0,h,f),t.restore()}}class kt{ctx=null;init(){this.ctx=new AudioContext}playShoot(){if(!this.ctx)return;const t=this.ctx.createOscillator(),e=this.ctx.createGain();t.type="sawtooth",t.frequency.setValueAtTime(800,this.ctx.currentTime),t.frequency.exponentialRampToValueAtTime(100,this.ctx.currentTime+.1),e.gain.setValueAtTime(.2,this.ctx.currentTime),e.gain.exponentialRampToValueAtTime(.001,this.ctx.currentTime+.12),t.connect(e).connect(this.ctx.destination),t.start(),t.stop(this.ctx.currentTime+.12)}playHit(){if(!this.ctx)return;const t=this.ctx.createOscillator(),e=this.ctx.createGain();t.type="square",t.frequency.setValueAtTime(400,this.ctx.currentTime),t.frequency.exponentialRampToValueAtTime(200,this.ctx.currentTime+.05),e.gain.setValueAtTime(.15,this.ctx.currentTime),e.gain.exponentialRampToValueAtTime(.001,this.ctx.currentTime+.08),t.connect(e).connect(this.ctx.destination),t.start(),t.stop(this.ctx.currentTime+.08)}playEnemyDeath(){if(!this.ctx)return;const t=this.ctx.createOscillator(),e=this.ctx.createGain();t.type="sawtooth",t.frequency.setValueAtTime(600,this.ctx.currentTime),t.frequency.exponentialRampToValueAtTime(50,this.ctx.currentTime+.3),e.gain.setValueAtTime(.2,this.ctx.currentTime),e.gain.exponentialRampToValueAtTime(.001,this.ctx.currentTime+.35),t.connect(e).connect(this.ctx.destination),t.start(),t.stop(this.ctx.currentTime+.35)}playDamage(){if(!this.ctx)return;const t=this.ctx.createOscillator(),e=this.ctx.createGain();t.type="sine",t.frequency.setValueAtTime(150,this.ctx.currentTime),t.frequency.exponentialRampToValueAtTime(60,this.ctx.currentTime+.2),e.gain.setValueAtTime(.25,this.ctx.currentTime),e.gain.exponentialRampToValueAtTime(.001,this.ctx.currentTime+.25),t.connect(e).connect(this.ctx.destination),t.start(),t.stop(this.ctx.currentTime+.25)}}const R=document.getElementById("game");R.width=h;R.height=f;const b=R.getContext("2d"),At=new ht,Pt=new lt,V=new ft(b,At),Rt=new ct,Ct=new dt(R),vt=new v,Dt=new St,F=new Et,Ot=new wt(b),A=new kt,S=new bt;let w,g,$,P,D,X=!0,Y=0;function Lt(){w=new ut;const p=w.findPlayerStart();g=new mt(p),Y=g.health,$=new gt(w),P=new Mt,D=new yt,A.init(),S.transitionTo("playing")}R.addEventListener("click",()=>{(S.phase==="menu"||S.phase==="gameover")&&Lt()});document.addEventListener("keydown",p=>{p.code==="KeyM"&&(X=!X)});function Wt(p){if(S.phase==="menu"){F.update(p);return}if(S.phase!=="playing")return;const t=Ct.getState();g.update(p,t,w),$.update(p,g),P.update(p);const e=t.forward||t.backward||t.strafeLeft||t.strafeRight;if(D.update(p,e),t.shoot){const i=P.tryShoot(g,D,w);i.hit?(A.playHit(),i.killed&&A.playEnemyDeath()):g.ammo>0&&A.playShoot()}g.health<Y&&(P.onPlayerDamaged(),A.playDamage()),Y=g.health,S.update(p),g.health<=0&&S.transitionTo("gameover")}function It(p){switch(S.phase){case"menu":F.renderTitle(b);break;case"playing":{const t=Pt.castAllRays(g.camera,w.map);V.renderFrame(t),Rt.renderSprites(b,g.camera,w.entities,V.zBuffer),D.render(b),P.renderFeedback(b),Dt.render(b,g,S),X&&vt.render(b,w.map,g.camera,w.entities),Ot.apply(b);break}case"gameover":F.renderGameOver(b,g,S.elapsedTime);break}}const Ft=new U(nt,Wt,It);Ft.start();
