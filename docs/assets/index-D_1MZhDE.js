(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();class J{lastTime=0;accumulator=0;running=!1;fixedDt;updateFn;renderFn;constructor(e,t,i){this.fixedDt=e,this.updateFn=t,this.renderFn=i}start(){this.running=!0,this.lastTime=performance.now(),requestAnimationFrame(e=>this.tick(e))}tick(e){if(!this.running)return;const t=Math.min((e-this.lastTime)/1e3,.1);for(this.lastTime=e,this.accumulator+=t;this.accumulator>=this.fixedDt;)this.updateFn(this.fixedDt),this.accumulator-=this.fixedDt;this.renderFn(this.accumulator/this.fixedDt),requestAnimationFrame(i=>this.tick(i))}stop(){this.running=!1}}const l=960,f=600,z=Math.PI/3,F=l,T=64,b=64,w=3,N=2,j=.25,A=60,K=100,Z=K/A,_=-.5,Q=10,B=1,q=8,ee=0,te=1e6,se=100,ie=25,G=10,ae=500,X=1e4,oe=X,ne=60,re=1/ne;class le{pos;dir;plane;constructor(e,t,i){this.pos={x:e,y:t},this.dir={x:Math.cos(i),y:Math.sin(i)};const s=Math.tan(z/2);this.plane={x:-this.dir.y*s,y:this.dir.x*s}}rotate(e){const t=Math.cos(e),i=Math.sin(e),s=this.dir.x;this.dir.x=this.dir.x*t-this.dir.y*i,this.dir.y=s*i+this.dir.y*t;const a=this.plane.x;this.plane.x=this.plane.x*t-this.plane.y*i,this.plane.y=a*i+this.plane.y*t}}class he{castAllRays(e,t){const i=new Array(F);for(let s=0;s<F;s++)i[s]=this.castRay(e,t,s);return i}castRay(e,t,i){const s=2*i/F-1,a=e.dir.x+e.plane.x*s,o=e.dir.y+e.plane.y*s;let n=Math.floor(e.pos.x),r=Math.floor(e.pos.y);const h=Math.abs(1/a),c=Math.abs(1/o);let d,u,m,y;a<0?(d=-1,m=(e.pos.x-n)*h):(d=1,m=(n+1-e.pos.x)*h),o<0?(u=-1,y=(e.pos.y-r)*c):(u=1,y=(r+1-e.pos.y)*c);let k=0,x=64;for(;x-- >0&&(m<y?(m+=h,n+=d,k=0):(y+=c,r+=u,k=1),!(r>=0&&r<t.height&&n>=0&&n<t.width&&t.grid[r][n]>0)););const I=k===0?m-h:y-c;let W=k===0?e.pos.y+I*o:e.pos.x+I*a;return W-=Math.floor(W),{distance:Math.max(I,.001),wallX:W,side:k,mapX:n,mapY:r,tileType:r>=0&&r<t.height&&n>=0&&n<t.width?t.grid[r][n]:1}}}class fe{textures=new Map;constructor(){this.generateWallTextures()}generateWallTextures(){this.textures.set(1,this.generateBlueBrick()),this.textures.set(2,this.generateMetalPanel()),this.textures.set(3,this.generateCircuitBoard()),this.textures.set(4,this.generateWarningStripes())}generateBlueBrick(){const e=new Uint8ClampedArray(T*b*4),t=16,i=32;for(let s=0;s<b;s++)for(let a=0;a<T;a++){const n=Math.floor(s/t)%2*(i/2),r=(a+n)%i,h=s%t===0||r===0,c=(s*T+a)*4;if(h)e[c]=30,e[c+1]=40,e[c+2]=60,e[c+3]=255;else{const d=Math.random()*15-7;e[c]=50+d,e[c+1]=108+d,e[c+2]=229+Math.min(0,d),e[c+3]=255}}return e}generateMetalPanel(){const e=new Uint8ClampedArray(T*b*4);for(let t=0;t<b;t++)for(let i=0;i<T;i++){const s=(t*T+i)*4,a=t%32===0||i%32===0;if((t%32===4||t%32===28)&&i%8===4)e[s]=160,e[s+1]=160,e[s+2]=170,e[s+3]=255;else if(a)e[s]=40,e[s+1]=40,e[s+2]=45,e[s+3]=255;else{const n=Math.random()*10-5;e[s]=80+n,e[s+1]=82+n,e[s+2]=88+n,e[s+3]=255}}return e}generateCircuitBoard(){const e=new Uint8ClampedArray(T*b*4);for(let t=0;t<b;t++)for(let i=0;i<T;i++){const s=(t*T+i)*4;if(i%8===0||t%8===0)e[s]=30,e[s+1]=180,e[s+2]=30,e[s+3]=255;else{const o=Math.random()*8-4;e[s]=15+o,e[s+1]=50+o,e[s+2]=15+o,e[s+3]=255}}return e}generateWarningStripes(){const e=new Uint8ClampedArray(T*b*4);for(let t=0;t<b;t++)for(let i=0;i<T;i++){const s=(t*T+i)*4;(i+t)%16<8?(e[s]=220,e[s+1]=200,e[s+2]=0,e[s+3]=255):(e[s]=30,e[s+1]=30,e[s+2]=30,e[s+3]=255)}return e}getPixel(e,t,i){const s=this.textures.get(e);if(!s)return[128,128,128];const a=(i*T+t)*4;return[s[a],s[a+1],s[a+2]]}}class ce{imageData;buf;zBuffer;ctx;textures;constructor(e,t){this.ctx=e,this.textures=t,this.imageData=e.createImageData(l,f),this.buf=new Uint32Array(this.imageData.data.buffer),this.zBuffer=new Array(l)}renderFrame(e){this.drawCeilingAndFloor(),this.drawWalls(e),this.ctx.putImageData(this.imageData,0,0)}drawCeilingAndFloor(){const e=f/2;for(let t=0;t<f;t++){const i=t<e?e/(e-t):e/(t-e+1),s=Math.min(1,i/14),a=t*l;if(t<e){const n=Math.floor(25*(1-s*.7)),r=Math.floor(25*(1-s*.7)),h=Math.floor(40*(1-s*.5)),c=255<<24|h<<16|r<<8|n;for(let d=0;d<l;d++)this.buf[a+d]=c}else{const n=Math.floor(20*(1-s*.8)),r=Math.floor(25*(1-s*.8)),h=Math.floor(20*(1-s*.8)),c=255<<24|h<<16|r<<8|n;for(let d=0;d<l;d++)this.buf[a+d]=c}}}drawWalls(e){for(let t=0;t<e.length;t++){const i=e[t];this.zBuffer[t]=i.distance;const s=Math.floor(f/i.distance),a=Math.max(0,Math.floor(-s/2+f/2)),o=Math.min(f-1,Math.floor(s/2+f/2));let n=Math.floor(i.wallX*T);n>=T&&(n=T-1);const r=b/s;let h=(a-f/2+s/2)*r;for(let c=a;c<=o;c++){const d=Math.floor(h)&b-1;h+=r;let[u,m,y]=this.textures.getPixel(i.tileType,n,d);i.side===1&&(u=u>>1,m=m>>1,y=y>>1);const k=Math.min(1,i.distance/12);u=Math.floor(u*(1-k)),m=Math.floor(m*(1-k)),y=Math.floor(y*(1-k)),this.buf[c*l+t]=255<<24|y<<16|m<<8|u}}}}const H=["sendBufferEmailsEachOneMinute * * * * *","sendBufferEmailsEachOneMinute * * * * *","sendBufferEmailsEachOneMinute * * * * *","sendBufferEmailsEachOneMinute * * * * *","sendBufferEmailsEachOneMinute * * * * *","sendBufferEmailsEachOneMinute * * * * *","sendBufferEmailsEachOneMinute * * * * *","sendBufferEmailsEachFiveMinutes */5 * * * *","sendBufferEmailsEachFiveMinutes */5 * * * *","programFinished * * * * *","triggerUsersProgressWhenClassroomSlotEnds * * * * *","sendClassroomSlotNotifications * * * * *"];class ${pos;dir;health;alive;cronExpression;state;patrolTarget;attackCooldown;deathTimer;constructor(e){this.pos={x:e.x,y:e.y},this.dir={x:1,y:0},this.health=Q,this.alive=!0,this.cronExpression=H[Math.floor(Math.random()*H.length)],this.state="patrol",this.patrolTarget=null,this.attackCooldown=0,this.deathTimer=0}takeDamage(e){return this.health-=e,this.health<=0?(this.alive=!1,this.state="dead",this.deathTimer=2,!0):!1}}class de{spriteBuffer;spriteCtx;constructor(){this.spriteBuffer=new OffscreenCanvas(64,64),this.spriteCtx=this.spriteBuffer.getContext("2d")}renderSprites(e,t,i,s){const a=[];for(const o of i){if(!o.alive&&o.deathTimer<=0)continue;const n=this.computeSpriteData(t,o);n&&a.push(n)}a.sort((o,n)=>n.transformY-o.transformY);for(const o of a)this.drawSprite(e,o,s)}computeSpriteData(e,t){const i=t.pos.x-e.pos.x,s=t.pos.y-e.pos.y,a=1/(e.plane.x*e.dir.y-e.dir.x*e.plane.y),o=a*(e.dir.y*i-e.dir.x*s),n=a*(-e.plane.y*i+e.plane.x*s);if(n<=.1)return null;const r=Math.floor(l/2*(1+o/n)),h=Math.abs(Math.floor(f/n)),c=h,d=Math.max(0,Math.floor(-h/2+f/2)),u=Math.min(f-1,Math.floor(h/2+f/2)),m=Math.max(0,Math.floor(-c/2+r)),y=Math.min(l-1,Math.floor(c/2+r));return{screenX:r,transformY:n,spriteHeight:h,spriteWidth:c,drawStartX:m,drawEndX:y,drawStartY:d,drawEndY:u,entity:t}}drawSprite(e,t,i){this.renderCronJobTexture(t.entity);const s=t.screenX-t.spriteWidth/2,a=t.drawEndY-t.drawStartY;for(let o=t.drawStartX;o<=t.drawEndX;o++)if(t.transformY<i[o]){const n=Math.floor((o-s)/t.spriteWidth*64);n>=0&&n<64&&e.drawImage(this.spriteBuffer,n,0,1,64,o,t.drawStartY,1,a)}}renderCronJobTexture(e){const t=this.spriteCtx;t.clearRect(0,0,64,64);const i=e.alive?e.health>15?"#326CE5":"#CC0000":"#555";t.fillStyle=i,this.roundRect(t,4,4,56,56,8),t.fill(),t.strokeStyle="#fff",t.lineWidth=1.5,t.beginPath(),t.arc(32,20,9,0,Math.PI*2),t.stroke();for(let s=0;s<7;s++){const a=s/7*Math.PI*2;t.beginPath(),t.moveTo(32+Math.cos(a)*4,20+Math.sin(a)*4),t.lineTo(32+Math.cos(a)*9,20+Math.sin(a)*9),t.stroke()}t.fillStyle="#fff",t.font="bold 9px monospace",t.textAlign="center",t.fillText("CronJob",32,44),t.font="7px monospace",t.fillStyle="#aaddff",t.fillText(e.cronExpression,32,56)}roundRect(e,t,i,s,a,o){e.beginPath(),e.moveTo(t+o,i),e.lineTo(t+s-o,i),e.quadraticCurveTo(t+s,i,t+s,i+o),e.lineTo(t+s,i+a-o),e.quadraticCurveTo(t+s,i+a,t+s-o,i+a),e.lineTo(t+o,i+a),e.quadraticCurveTo(t,i+a,t,i+a-o),e.lineTo(t,i+o),e.quadraticCurveTo(t,i,t+o,i),e.closePath()}}class pe{keys=new Set;_mouseDeltaX=0;pointerLocked=!1;shootTriggered=!1;canvas;constructor(e){this.canvas=e,document.addEventListener("keydown",t=>{this.keys.add(t.code),t.preventDefault()}),document.addEventListener("keyup",t=>{this.keys.delete(t.code)}),document.addEventListener("mousemove",t=>{this.pointerLocked&&(this._mouseDeltaX+=t.movementX)}),document.addEventListener("mousedown",t=>{t.button===0&&this.pointerLocked&&(this.shootTriggered=!0)}),e.addEventListener("click",()=>{this.pointerLocked||e.requestPointerLock()}),document.addEventListener("pointerlockchange",()=>{this.pointerLocked=document.pointerLockElement===this.canvas})}get isPointerLocked(){return this.pointerLocked}getState(){const e=this.shootTriggered||this.keys.has("Space");this.shootTriggered=!1;const t={forward:this.keys.has("KeyW")||this.keys.has("ArrowUp"),backward:this.keys.has("KeyS")||this.keys.has("ArrowDown"),strafeLeft:this.keys.has("KeyA"),strafeRight:this.keys.has("KeyD"),rotateLeft:this.keys.has("ArrowLeft"),rotateRight:this.keys.has("ArrowRight"),shoot:e,mouseDeltaX:this._mouseDeltaX};return this._mouseDeltaX=0,t}}class D{static SCALE=6;static OPACITY=.7;render(e,t,i,s){const a=D.SCALE,o=10,n=10;e.save(),e.globalAlpha=D.OPACITY;for(let r=0;r<t.height;r++)for(let h=0;h<t.width;h++)e.fillStyle=t.grid[r][h]>0?"#555":"#111",e.fillRect(o+h*a,n+r*a,a,a);e.fillStyle="#326CE5",e.beginPath(),e.arc(o+i.pos.x*a,n+i.pos.y*a,3,0,Math.PI*2),e.fill(),e.strokeStyle="#326CE5",e.lineWidth=2,e.beginPath(),e.moveTo(o+i.pos.x*a,n+i.pos.y*a),e.lineTo(o+(i.pos.x+i.dir.x*2)*a,n+(i.pos.y+i.dir.y*2)*a),e.stroke();for(const r of s)r.alive&&(e.fillStyle="#f00",e.beginPath(),e.arc(o+r.pos.x*a,n+r.pos.y*a,2,0,Math.PI*2),e.fill());e.restore()}}class ue{static generate(e,t){const i=[];for(let o=0;o<t;o++){i[o]=[];for(let n=0;n<e;n++)i[o][n]=1}const s=[];for(let o=0;o<t;o++)s[o]=new Array(e).fill(!1);const a=(o,n)=>{s[n][o]=!0,i[n][o]=0;const r=[[0,-2],[0,2],[-2,0],[2,0]];for(let h=r.length-1;h>0;h--){const c=Math.floor(Math.random()*(h+1));[r[h],r[c]]=[r[c],r[h]]}for(const[h,c]of r){const d=o+h,u=n+c;d>0&&d<e-1&&u>0&&u<t-1&&!s[u][d]&&(i[n+c/2][o+h/2]=0,a(d,u))}};a(1,1);for(let o=0;o<t;o++)for(let n=0;n<e;n++)i[o][n]>0&&(i[o][n]=(n*7+o*13)%4+1);return i}}const C=10;class me{map;entities;spawnPoints;constructor(){const e=ue.generate(C,C);this.map={width:C,height:C,grid:e},this.spawnPoints=this.findOpenCells(30),this.entities=[]}isWall(e,t){const i=Math.floor(e),s=Math.floor(t);return isNaN(i)||isNaN(s)||i<0||i>=this.map.width||s<0||s>=this.map.height?!0:this.map.grid[s][i]>0}findOpenCells(e){const t=[];for(let i=1;i<this.map.height-1;i++)for(let s=1;s<this.map.width-1;s++)this.map.grid[i][s]===0&&t.push({x:s+.5,y:i+.5});for(let i=t.length-1;i>0;i--){const s=Math.floor(Math.random()*(i+1));[t[i],t[s]]=[t[s],t[i]]}return t.slice(0,e)}findPlayerStart(){for(let e=1;e<this.map.height-1;e++)for(let t=1;t<this.map.width-1;t++)if(this.map.grid[e][t]===0){const i={x:t+.5,y:e+.5};if(this.spawnPoints.reduce((a,o)=>{const n=Math.sqrt((o.x-i.x)**2+(o.y-i.y)**2);return Math.min(a,n)},1/0)>4)return i}return this.findOpenCells(1)[0]}}class Te{camera;health;ammo;score;kills;constructor(e){this.camera=new le(e.x,e.y,0),this.health=K,this.ammo=oe,this.score=0,this.kills=0}update(e,t,i){t.rotateLeft&&this.camera.rotate(-N*e),t.rotateRight&&this.camera.rotate(N*e),t.mouseDeltaX!==0&&this.camera.rotate(t.mouseDeltaX*.003);let s=0,a=0;t.forward&&(s+=this.camera.dir.x*w*e,a+=this.camera.dir.y*w*e),t.backward&&(s-=this.camera.dir.x*w*e,a-=this.camera.dir.y*w*e),t.strafeLeft&&(s-=this.camera.plane.x*w*e,a-=this.camera.plane.y*w*e),t.strafeRight&&(s+=this.camera.plane.x*w*e,a+=this.camera.plane.y*w*e),this.applyMovement(s,a,i)}get isMoving(){return!1}applyMovement(e,t,i){if(e===0&&t===0)return;const s=j,a=this.camera.pos.x+e;!i.isWall(a+s,this.camera.pos.y+s)&&!i.isWall(a+s,this.camera.pos.y-s)&&!i.isWall(a-s,this.camera.pos.y+s)&&!i.isWall(a-s,this.camera.pos.y-s)&&(this.camera.pos.x=a);const o=this.camera.pos.y+t;!i.isWall(this.camera.pos.x+s,o+s)&&!i.isWall(this.camera.pos.x+s,o-s)&&!i.isWall(this.camera.pos.x-s,o+s)&&!i.isWall(this.camera.pos.x-s,o-s)&&(this.camera.pos.y=o)}}class ge{update(e,t,i,s){if(!e.alive){e.deathTimer-=s;return}const a=this.distance(e.pos,t.camera.pos),o=this.lineOfSight(e.pos,t.camera.pos,i);switch(e.state){case"patrol":this.patrol(e,i,s),o&&a<q&&(e.state="chase");break;case"chase":this.chase(e,t,i,s),a<B?e.state="attack":(!o||a>q*1.5)&&(e.state="patrol");break;case"attack":this.attack(e,t,s),a>B*1.5&&(e.state="chase");break}}patrol(e,t,i){(!e.patrolTarget||this.distance(e.pos,e.patrolTarget)<.5)&&(e.patrolTarget=this.randomOpenNeighbor(e.pos,t)),e.patrolTarget&&this.moveToward(e,e.patrolTarget,_*.5,t,i)}chase(e,t,i,s){this.moveToward(e,t.camera.pos,_,i,s)}attack(e,t,i){e.attackCooldown-=i,e.attackCooldown<=0&&(t.health-=ee,e.attackCooldown=1.5)}lineOfSight(e,t,i){const s=t.x-e.x,a=t.y-e.y,o=Math.sqrt(s*s+a*a),n=Math.ceil(o*4);for(let r=0;r<=n;r++){const h=r/n,c=e.x+s*h,d=e.y+a*h;if(i.isWall(c,d))return!1}return!0}moveToward(e,t,i,s,a){const o=t.x-e.pos.x,n=t.y-e.pos.y,r=Math.sqrt(o*o+n*n);if(r<.01)return;const h=o/r*i*a,c=n/r*i*a,d=.2,u=e.pos.x+h,m=e.pos.y+c;!s.isWall(u+d*Math.sign(h),e.pos.y+d)&&!s.isWall(u+d*Math.sign(h),e.pos.y-d)&&(e.pos.x=u),!s.isWall(e.pos.x+d,m+d*Math.sign(c))&&!s.isWall(e.pos.x-d,m+d*Math.sign(c))&&(e.pos.y=m),e.dir={x:o/r,y:n/r}}distance(e,t){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}randomOpenNeighbor(e,t){for(let i=0;i<10;i++){const s=Math.floor(e.x)+Math.floor(Math.random()*7)-3,a=Math.floor(e.y)+Math.floor(Math.random()*7)-3;if(!t.isWall(s+.5,a+.5))return{x:s+.5,y:a+.5}}return null}}class Me{respawnTimers=[];enemyAI=new ge;world;constructor(e){this.world=e;for(const t of e.spawnPoints){const i=new $(t);e.entities.push(i)}}update(e,t){for(const i of this.world.entities)this.enemyAI.update(i,t,this.world,e);for(let i=this.world.entities.length-1;i>=0;i--){const s=this.world.entities[i];if(!s.alive&&s.deathTimer<=0){this.world.entities.splice(i,1);const a=Math.floor(Math.random()*this.world.spawnPoints.length);this.respawnTimers.push({spawnPointIdx:a,timer:te/1e3})}}for(let i=this.respawnTimers.length-1;i>=0;i--)if(this.respawnTimers[i].timer-=e,this.respawnTimers[i].timer<=0){if(this.world.entities.length<se){const s=this.world.spawnPoints[this.respawnTimers[i].spawnPointIdx];this.world.entities.push(new $(s))}this.respawnTimers.splice(i,1)}}}class ye{state="idle";animTimer=0;bobPhase=0;recoilOffset=0;update(e,t){switch(t&&(this.bobPhase+=e*8),this.state){case"firing":this.animTimer-=e,this.recoilOffset=Math.max(0,this.animTimer/.1)*20,this.animTimer<=0&&(this.state="cooldown",this.animTimer=ae/1e3);break;case"cooldown":this.animTimer-=e,this.recoilOffset=0,this.animTimer<=0&&(this.state="idle");break}}fire(){return this.state!=="idle"?!1:(this.state="firing",this.animTimer=.1,!0)}render(e){const t=Math.sin(this.bobPhase)*4,i=Math.abs(Math.cos(this.bobPhase))*4,s=l/2-40+t,a=f-120+i+this.recoilOffset;e.save(),e.fillStyle="#222",e.beginPath(),this.roundedRect(e,s,a,80,100,6),e.fill(),e.strokeStyle="#444",e.lineWidth=1,e.beginPath(),this.roundedRect(e,s,a,80,100,6),e.stroke(),e.fillStyle="#0a0a0a",e.fillRect(s+8,a+8,64,44),e.fillStyle="#00ff00",e.font="8px monospace",e.textAlign="left",e.fillText("$ kubectl",s+12,a+22),e.fillText("  delete pod",s+12,a+34),e.fillStyle="#00aa00",e.fillText("  --force",s+12,a+46),e.fillStyle="#444",e.fillRect(s+30,a-10,20,15),e.fillStyle="#333",e.fillRect(s+33,a-8,14,11),this.state==="firing"&&(e.fillStyle="#ffaa00",e.globalAlpha=.8,e.beginPath(),e.arc(s+40,a-15,25,0,Math.PI*2),e.fill(),e.fillStyle="#fff",e.beginPath(),e.arc(s+40,a-15,12,0,Math.PI*2),e.fill(),e.globalAlpha=1),e.restore()}roundedRect(e,t,i,s,a,o){e.moveTo(t+o,i),e.lineTo(t+s-o,i),e.quadraticCurveTo(t+s,i,t+s,i+o),e.lineTo(t+s,i+a-o),e.quadraticCurveTo(t+s,i+a,t+s-o,i+a),e.lineTo(t+o,i+a),e.quadraticCurveTo(t,i+a,t,i+a-o),e.lineTo(t,i+o),e.quadraticCurveTo(t,i,t+o,i),e.closePath()}}class Se{hitFeedbackTimer=0;killFeedbackTimer=0;lastKillLabel="";damageFlashTimer=0;tryShoot(e,t,i){if(e.ammo<=0||!t.fire())return{hit:!1,enemy:null,killed:!1};e.ammo--;const s=e.camera;let a=null,o=G;for(const n of i.entities){if(!n.alive)continue;const r=n.pos.x-s.pos.x,h=n.pos.y-s.pos.y,c=r*s.dir.x+h*s.dir.y;if(c<=0||c>G)continue;Math.abs(r*s.dir.y-h*s.dir.x)<.4&&c<o&&this.hasLineOfSight(s.pos,n.pos,i)&&(o=c,a=n)}if(a){const n=a.takeDamage(ie);return this.hitFeedbackTimer=.15,n&&(e.score+=100,e.kills++,this.killFeedbackTimer=1.5,this.lastKillLabel=`kubectl delete pod ${a.cronExpression}`),{hit:!0,enemy:a,killed:n}}return{hit:!1,enemy:null,killed:!1}}onPlayerDamaged(){this.damageFlashTimer=.3}update(e){this.hitFeedbackTimer>0&&(this.hitFeedbackTimer-=e),this.killFeedbackTimer>0&&(this.killFeedbackTimer-=e),this.damageFlashTimer>0&&(this.damageFlashTimer-=e)}renderFeedback(e){const t=l/2,i=f/2;if(e.strokeStyle=this.hitFeedbackTimer>0?"#ff0000":"#00ff00",e.lineWidth=2,e.beginPath(),e.moveTo(t-12,i),e.lineTo(t-4,i),e.moveTo(t+4,i),e.lineTo(t+12,i),e.moveTo(t,i-12),e.lineTo(t,i-4),e.moveTo(t,i+4),e.lineTo(t,i+12),e.stroke(),e.fillStyle=this.hitFeedbackTimer>0?"#ff0000":"#00ff00",e.beginPath(),e.arc(t,i,2,0,Math.PI*2),e.fill(),this.hitFeedbackTimer>0&&(e.fillStyle=`rgba(255, 50, 0, ${this.hitFeedbackTimer/.15*.15})`,e.beginPath(),e.arc(t,i,18,0,Math.PI*2),e.fill()),this.killFeedbackTimer>0){const s=Math.min(1,this.killFeedbackTimer);e.fillStyle=`rgba(255, 255, 255, ${s})`,e.font="bold 24px monospace",e.textAlign="center",e.fillText("ðŸ’€ "+this.lastKillLabel+" ðŸ’€",l/2,f/2+50)}if(this.damageFlashTimer>0){const s=this.damageFlashTimer/.3*.4;e.fillStyle=`rgba(255, 0, 0, ${s})`,e.fillRect(0,0,l,f)}}hasLineOfSight(e,t,i){const s=t.x-e.x,a=t.y-e.y,o=Math.sqrt(s*s+a*a),n=Math.ceil(o*4);for(let r=1;r<n;r++){const h=r/n;if(i.isWall(e.x+s*h,e.y+a*h))return!1}return!0}}class be{phase="menu";elapsedTime=0;transitionTo(e){this.phase=e,e==="playing"&&(this.elapsedTime=0)}update(e){this.phase==="playing"&&(this.elapsedTime+=e)}}class Ee{render(e,t,i){e.save(),e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,f-50,l,50),e.font="bold 14px monospace";const s=t.health>60?"#00ff00":t.health>30?"#ffaa00":"#ff0000";e.fillStyle=s,e.textAlign="left",e.fillText(`HEALTH: ${Math.round(Math.max(0,t.health))}`,20,f-18),e.strokeStyle="#555",e.lineWidth=1,e.strokeRect(20,f-45,100,10),e.fillStyle=s,e.fillRect(20,f-45,Math.max(0,t.health),10),e.fillStyle=t.ammo>10?"#00ff00":"#ff0000",e.textAlign="center",e.fillText(`AMMO: ${t.ammo}/${X}`,l/2,f-18);const a=100,o=l/2-a/2;e.strokeStyle="#555",e.strokeRect(o,f-45,a,10),e.fillStyle=t.ammo>10?"#00ff00":"#ff0000",e.fillRect(o,f-45,t.ammo/X*a,10),e.fillStyle="#326CE5",e.textAlign="right",e.fillText(`SCORE: ${t.score}`,l-20,f-28),e.fillStyle="#aaa",e.font="12px monospace",e.fillText(`PODS DELETED: ${t.kills}`,l-20,f-12);const n=Math.max(0,A-i.elapsedTime),r=n<=10?"#ff0000":"#888";e.fillStyle=r,e.font=n<=10?"bold 14px monospace":"12px monospace",e.textAlign="right";const h=Math.floor(n/60),c=Math.ceil(n%60);e.fillText(`TIME: ${String(h).padStart(2,"0")}:${String(c).padStart(2,"0")}`,l-20,20),e.restore()}}class ke{wheelAngle=0;update(e){this.wheelAngle+=e*.5}renderTitle(e){e.fillStyle="#000",e.fillRect(0,0,l,f),e.fillStyle="rgba(50, 108, 229, 0.03)";for(let i=0;i<f;i+=4)e.fillRect(0,i,l,2);e.fillStyle="#326CE5",e.font="bold 52px monospace",e.textAlign="center",e.fillText("K8S DOOM",l/2,f/4),e.fillStyle="#aaa",e.font="16px monospace",e.fillText("You are kube control plane (god itself)",l/2,f/4+15+25),e.fillText("You need to Terminate the CronJobs to downscale",l/2,f/4+15+50),e.fillText("Money flies away ðŸ’¸ you have no more than "+A+" to clear things up",l/2,f/4+15+75),e.fillText("ðŸ”¥ GOD MODE ACTIVATED ðŸ”¥ - NO MERCY",l/2,f/4+15+100),this.drawK8sWheel(e,l/2,f/2+30,45),e.fillStyle="#666",e.font="13px monospace",e.fillText("WASD/ZQSD - Move laterally | â†â†‘â†’â†“/Mouse - Turn  |  Click/Space - Shoot",l/2,f*.72),e.fillText("ESC - Release mouse  |  M - Toggle minimap",l/2,f*.76),e.fillStyle="#326CE5",e.font="bold 18px monospace",Math.sin(Date.now()/500)>0&&e.fillText("[ CLICK TO START ]",l/2,f*.87)}renderWin(e,t,i){e.fillStyle="rgba(0, 0, 0, 0.85)",e.fillRect(0,0,l,f),this.drawK8sWheelColored(e,l/2,f/5,40,"#00ff00"),e.fillStyle="#00ff00",e.font="bold 40px monospace",e.textAlign="center",e.fillText("CLUSTER NUKED",l/2,f/5+85),e.fillStyle="#aaa",e.font="15px monospace",e.fillText("Good game, you have nuked the cluster node",l/2,f/5+115),e.fillStyle="#326CE5",e.font="18px monospace";const s=f/2+10,a=Math.round(Math.max(0,A-i)),o=a*100,n=Math.floor(i/60),r=Math.floor(i%60);e.fillText(`Pods Deleted: ${t.kills}`,l/2,s),e.fillText(`Time: ${String(n).padStart(2,"0")}:${String(r).padStart(2,"0")}`,l/2,s+32),e.fillStyle="#ffaa00",e.fillText(`Time Bonus: +${a}s = +${o} pts`,l/2,s+64),e.fillStyle="#326CE5",e.fillText(`Score: ${t.score}`,l/2,s+96),e.fillStyle="#00ff00",e.font="bold 16px monospace",Math.sin(Date.now()/500)>0&&e.fillText("[ CLICK TO PLAY AGAIN ]",l/2,f*.87)}renderGameOver(e,t,i){e.fillStyle="rgba(0, 0, 0, 0.85)",e.fillRect(0,0,l,f),e.fillStyle="#ff0000",e.font="bold 44px monospace",e.textAlign="center",e.fillText("CLUSTER",l/2,f/4),e.fillText("TERMINATED",l/2,f/4+50),e.fillStyle="#888",e.font="16px monospace",e.fillText("CronJobs overwhelmed the cluster",l/2,f/4+90),e.fillStyle="#aaa",e.font="18px monospace";const s=f/2+10;e.fillText(`Pods Deleted: ${t.kills}`,l/2,s),e.fillText(`Score: ${t.score}`,l/2,s+30);const a=Math.floor(i/60),o=Math.floor(i%60);e.fillText(`Time Survived: ${String(a).padStart(2,"0")}:${String(o).padStart(2,"0")}`,l/2,s+60),e.fillStyle="#326CE5",e.font="bold 16px monospace",Math.sin(Date.now()/500)>0&&e.fillText("[ CLICK TO RESTART ]",l/2,f*.85)}drawK8sWheelColored(e,t,i,s,a){e.save(),e.translate(t,i),e.rotate(this.wheelAngle),e.strokeStyle=a,e.lineWidth=3,e.beginPath(),e.arc(0,0,s,0,Math.PI*2),e.stroke(),e.beginPath(),e.arc(0,0,s*.3,0,Math.PI*2),e.stroke();for(let o=0;o<7;o++){const n=o/7*Math.PI*2,r=s*.3,h=s*.85;e.beginPath(),e.moveTo(Math.cos(n)*r,Math.sin(n)*r),e.lineTo(Math.cos(n)*h,Math.sin(n)*h),e.stroke(),e.fillStyle=a,e.beginPath(),e.arc(Math.cos(n)*h,Math.sin(n)*h,6,0,Math.PI*2),e.fill()}e.restore()}drawK8sWheel(e,t,i,s){e.save(),e.translate(t,i),e.rotate(this.wheelAngle),e.strokeStyle="#326CE5",e.lineWidth=3,e.beginPath(),e.arc(0,0,s,0,Math.PI*2),e.stroke(),e.beginPath(),e.arc(0,0,s*.3,0,Math.PI*2),e.stroke();for(let a=0;a<7;a++){const o=a/7*Math.PI*2,n=s*.3,r=s*.85;e.beginPath(),e.moveTo(Math.cos(o)*n,Math.sin(o)*n),e.lineTo(Math.cos(o)*r,Math.sin(o)*r),e.stroke(),e.fillStyle="#326CE5",e.beginPath(),e.arc(Math.cos(o)*r,Math.sin(o)*r,6,0,Math.PI*2),e.fill()}e.restore()}}class we{enabled=!0;scanlinePattern=null;constructor(e){const t=new OffscreenCanvas(l,4),i=t.getContext("2d");i.clearRect(0,0,l,4),i.fillStyle="rgba(0, 0, 0, 0.12)",i.fillRect(0,2,l,2),this.scanlinePattern=e.createPattern(t,"repeat")}toggle(){this.enabled=!this.enabled}apply(e){if(!this.enabled)return;e.save(),this.scanlinePattern&&(e.fillStyle=this.scanlinePattern,e.fillRect(0,0,l,f));const t=e.createRadialGradient(l/2,f/2,l*.3,l/2,f/2,l*.7);t.addColorStop(0,"rgba(0, 0, 0, 0)"),t.addColorStop(1,"rgba(0, 0, 0, 0.45)"),e.fillStyle=t,e.fillRect(0,0,l,f),e.restore()}}class Ae{ctx=null;init(){this.ctx=new AudioContext}playShoot(){if(!this.ctx)return;const e=this.ctx.createOscillator(),t=this.ctx.createGain();e.type="sawtooth",e.frequency.setValueAtTime(800,this.ctx.currentTime),e.frequency.exponentialRampToValueAtTime(100,this.ctx.currentTime+.1),t.gain.setValueAtTime(.2,this.ctx.currentTime),t.gain.exponentialRampToValueAtTime(.001,this.ctx.currentTime+.12),e.connect(t).connect(this.ctx.destination),e.start(),e.stop(this.ctx.currentTime+.12)}playHit(){if(!this.ctx)return;const e=this.ctx.createOscillator(),t=this.ctx.createGain();e.type="square",e.frequency.setValueAtTime(400,this.ctx.currentTime),e.frequency.exponentialRampToValueAtTime(200,this.ctx.currentTime+.05),t.gain.setValueAtTime(.15,this.ctx.currentTime),t.gain.exponentialRampToValueAtTime(.001,this.ctx.currentTime+.08),e.connect(t).connect(this.ctx.destination),e.start(),e.stop(this.ctx.currentTime+.08)}playEnemyDeath(){if(!this.ctx)return;const e=this.ctx.createOscillator(),t=this.ctx.createGain();e.type="sawtooth",e.frequency.setValueAtTime(600,this.ctx.currentTime),e.frequency.exponentialRampToValueAtTime(50,this.ctx.currentTime+.3),t.gain.setValueAtTime(.2,this.ctx.currentTime),t.gain.exponentialRampToValueAtTime(.001,this.ctx.currentTime+.35),e.connect(t).connect(this.ctx.destination),e.start(),e.stop(this.ctx.currentTime+.35)}playDamage(){if(!this.ctx)return;const e=this.ctx.createOscillator(),t=this.ctx.createGain();e.type="sine",e.frequency.setValueAtTime(150,this.ctx.currentTime),e.frequency.exponentialRampToValueAtTime(60,this.ctx.currentTime+.2),t.gain.setValueAtTime(.25,this.ctx.currentTime),t.gain.exponentialRampToValueAtTime(.001,this.ctx.currentTime+.25),e.connect(t).connect(this.ctx.destination),e.start(),e.stop(this.ctx.currentTime+.25)}}const P=document.getElementById("game");P.width=l;P.height=f;const S=P.getContext("2d"),Pe=new fe,Ce=new he,V=new ce(S,Pe),Re=new de,ve=new pe(P),De=new D,Oe=new Ee,R=new ke,Le=new we(S),v=new Ae,M=new be;let E,g,U,O,L,Y=!0;function Ie(){E=new me;const p=E.findPlayerStart();g=new Te(p),U=new Me(E),O=new Se,L=new ye,v.init(),M.transitionTo("playing")}P.addEventListener("click",()=>{(M.phase==="menu"||M.phase==="gameover"||M.phase==="won")&&Ie()});document.addEventListener("keydown",p=>{p.code==="KeyM"&&(Y=!Y)});function We(p){if(M.phase==="menu"){R.update(p);return}if(M.phase!=="playing")return;const e=ve.getState();g.update(p,e,E),U.update(p,g),O.update(p);const t=e.forward||e.backward||e.strafeLeft||e.strafeRight;if(L.update(p,t),e.shoot){const i=O.tryShoot(g,L,E);i.hit?(v.playHit(),i.killed&&v.playEnemyDeath()):g.ammo>0&&v.playShoot()}if(g.health-=p*Z,M.update(p),g.kills>0&&E.entities.every(i=>!i.alive)){const i=Math.round(Math.max(0,A-M.elapsedTime));g.score+=i*100,M.transitionTo("won")}g.health<=0&&M.transitionTo("gameover")}function Fe(p){switch(M.phase){case"menu":R.renderTitle(S);break;case"playing":{const e=Ce.castAllRays(g.camera,E.map);V.renderFrame(e),Re.renderSprites(S,g.camera,E.entities,V.zBuffer),L.render(S),O.renderFeedback(S),Oe.render(S,g,M),Y&&De.render(S,E.map,g.camera,E.entities),Le.apply(S);break}case"gameover":R.renderGameOver(S,g,M.elapsedTime);break;case"won":R.renderWin(S,g,M.elapsedTime);break}}const Xe=new J(re,We,Fe);Xe.start();
